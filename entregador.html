<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Marcelo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, deleteDoc, doc, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBjP9dxFEp09DpZl5JkVMD05uaKoQTNDpE", authDomain: "meuappentregas.firebaseapp.com", projectId: "meuappentregas", storageBucket: "meuappentregas.firebasestorage.app", messagingSenderId: "442484186787", appId: "1:442484186787:web:ac914827ebebda987f2916" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        // CONFIGURAÇÃO DE PREÇO PADRÃO
        window.mudarPrecoPadrao = (v) => localStorage.setItem('precoPadrao', v);
        const getPreco = () => localStorage.getItem('precoPadrao') || "7";

        onSnapshot(query(collection(db, "chamados"), orderBy("timestamp", "asc")), (snaps) => {
            const lista = document.getElementById('listaChamados'); lista.innerHTML = "";
            snaps.forEach(d => {
                const c = d.data();
                if(c.status === "Pendente") {
                    lista.innerHTML += `
                    <div class="bg-white p-6 rounded-3xl shadow-xl mb-4 border-t-8 border-yellow-400">
                        <h2 class="font-black text-blue-900 uppercase mb-4">${c.loja} chamou!</h2>
                        <div class="grid grid-cols-3 gap-2">
                            <button onclick="responder('${d.id}', '5 min')" class="bg-blue-600 text-white p-3 rounded-xl font-bold">5m</button>
                            <button onclick="responder('${d.id}', '15 min')" class="bg-blue-600 text-white p-3 rounded-xl font-bold">15m</button>
                            <button onclick="responder('${d.id}', '30 min')" class="bg-blue-600 text-white p-3 rounded-xl font-bold">30m</button>
                        </div>
                    </div>`;
                } else if(c.status === "Confirmado") {
                    lista.innerHTML += `
                    <div class="bg-green-500 text-white p-6 rounded-3xl mb-4 font-black flex justify-between items-center italic uppercase">
                        <span>IR PARA: ${c.loja}</span>
                        <button onclick="finalizar('${d.id}')" class="bg-white text-green-600 px-4 py-2 rounded-xl text-xs">CHEGUEI</button>
                    </div>`;
                }
            });
        });

        window.responder = async (id, t) => await updateDoc(doc(db, "chamados", id), { status: "Respondido", tempo: t });
        window.finalizar = async (id) => await deleteDoc(doc(db, "chamados", id));
    </script>
</head>
<body class="bg-gray-100 p-4">
    <div class="max-w-md mx-auto">
        <div class="bg-white p-4 rounded-2xl mb-6 shadow-sm flex items-center justify-between">
            <span class="font-bold text-xs uppercase text-gray-400">Preço Padrão R$:</span>
            <input type="number" onchange="mudarPrecoPadrao(this.value)" value="7" class="w-16 text-right font-black text-blue-600 outline-none">
        </div>
        <div id="listaChamados"></div>
    </div>
</body>
</html>
