<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Entregador</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        const firebaseConfig = { apiKey: "AIzaSyBjP9dxFEp09DpZl5JkVMD05uaKoQTNDpE", authDomain: "meuappentregas.firebaseapp.com", projectId: "meuappentregas", storageBucket: "meuappentregas.firebasestorage.app", messagingSenderId: "442484186787", appId: "1:442484186787:web:ac914827ebebda987f2916" };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        onSnapshot(query(collection(db, "pedidos"), orderBy("timestamp", "asc")), (snaps) => {
            const lista = document.getElementById('rota');
            let total = 0;
            lista.innerHTML = "";
            snaps.forEach(d => {
                const p = d.data();
                total += p.valor;
                lista.innerHTML += `
                    <div class="bg-white p-5 rounded-3xl shadow-lg mb-4 border-l-8 border-blue-600">
                        <h3 class="font-black text-lg uppercase">${p.loja} <span class="text-green-600 italic">R$${p.valor}</span></h3>
                        <p class="text-xs text-gray-400 mb-2 font-bold italic">RECOLHER: ${p.retirada}</p>
                        <p class="text-blue-800 font-bold mb-3">${p.destino}</p>
                        <input id="rec-${d.id}" placeholder="Quem recebeu?" class="w-full p-2 bg-gray-50 rounded mb-2 border text-sm italic">
                        <div class="flex gap-2 text-[10px] font-bold">
                            <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.retirada)}')" class="flex-1 bg-gray-200 p-2 rounded-lg">üìç LOJA</button>
                            <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(p.destino)}')" class="flex-1 bg-gray-200 p-2 rounded-lg">üìç CLIENTE</button>
                            <button onclick="concluir('${d.id}', '${p.zap}', '${p.loja}', '${p.destino}', '${p.valor}')" class="flex-1 bg-green-500 text-white p-2 rounded-lg">CONCLUIR</button>
                        </div>
                    </div>`;
            });
            document.getElementById('caixa').innerText = `R$ ${total.toFixed(2)}`;
        });

        window.concluir = async (id, zap, loja, dest, valor) => {
            const rec = document.getElementById(`rec-${id}`).value || "N√£o informado";
            const msg = window.encodeURIComponent(`*ENTREGA CONCLU√çDA* ‚úÖ\n\nüìç *Origem:* ${loja}\nüèÅ *Destino:* ${dest}\nüë§ *Recebido por:* ${rec}\nüí∞ *Valor:* R$ ${valor}\n\nObrigado!`);
            window.open(`https://api.whatsapp.com/send?phone=55${zap}&text=${msg}`);
            await deleteDoc(doc(db, "pedidos", id));
        };
    </script>
</head>
<body class="bg-gray-900 p-4">
    <div class="max-w-md mx-auto">
        <div class="bg-blue-600 text-white p-6 rounded-3xl mb-6 flex justify-between items-center shadow-xl">
            <div><p class="text-[10px] uppercase font-bold opacity-70">A receber hoje</p><h1 id="caixa" class="text-3xl font-black">R$ 0,00</h1></div>
            <button onclick="if(confirm('Limpar dia?')) location.reload()" class="bg-white/20 p-2 rounded-xl text-xs">NOVO DIA</button>
        </div>
        <div id="rota"></div>
    </div>
</body>
</html>
