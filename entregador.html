<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Marcelo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, onSnapshot, query, orderBy, deleteDoc, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBjP9dxFEp09DpZl5JkVMD05uaKoQTNDpE", authDomain: "meuappentregas.firebaseapp.com", projectId: "meuappentregas", storageBucket: "meuappentregas.firebasestorage.app", messagingSenderId: "442484186787", appId: "1:442484186787:web:ac914827ebebda987f2916" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);

        // Função Online/Offline
        window.toggleStatus = async (s) => await setDoc(doc(db, "config", "status"), { online: s });
        
        onSnapshot(doc(db, "config", "status"), (d) => {
            const s = d.data()?.online;
            const b = document.getElementById('btnStatus');
            b.innerText = s ? "VOCÊ ESTÁ ONLINE" : "VOCÊ ESTÁ OFFLINE";
            b.className = s ? "w-full py-4 bg-green-500 text-white font-black rounded-2xl mb-4" : "w-full py-4 bg-red-500 text-white font-black rounded-2xl mb-4";
        });

        // Escutar Pedidos e Chamadas
        onSnapshot(query(collection(db, "pedidos"), orderBy("timestamp", "asc")), (snaps) => {
            const rota = document.getElementById('rota'); rota.innerHTML = "";
            snaps.forEach(d => {
                const p = d.data();
                const eChamada = p.status === "Chamando";
                rota.innerHTML += `
                    <div class="p-5 rounded-3xl shadow-lg mb-4 border-l-8 ${eChamada ? 'bg-yellow-100 border-yellow-500 animate-bounce' : 'bg-white border-blue-600'}">
                        <h3 class="font-black uppercase">${p.loja}</h3>
                        <p class="font-bold text-sm mb-3">${p.destino}</p>
                        <button onclick="remover('${d.id}')" class="w-full bg-black text-white py-2 rounded-xl text-xs font-bold uppercase italic">${eChamada ? 'ENTENDIDO / JÁ ESTOU INDO' : 'FINALIZAR ENTREGA'}</button>
                    </div>`;
            });
        });

        window.remover = async (id) => await deleteDoc(doc(db, "pedidos", id));
    </script>
</head>
<body class="bg-gray-900 p-4">
    <div class="max-w-md mx-auto">
        <button id="btnStatus" onclick="toggleStatus(this.innerText.includes('OFFLINE'))"></button>
        <div id="rota"></div>
    </div>
</body>
</html>
