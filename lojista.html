<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lojista - Quintana</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, where, doc, deleteDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        const firebaseConfig = { apiKey: "AIzaSyBjP9dxFEp09DpZl5JkVMD05uaKoQTNDpE", authDomain: "meuappentregas.firebaseapp.com", projectId: "meuappentregas", storageBucket: "meuappentregas.firebasestorage.app", messagingSenderId: "442484186787", appId: "1:442484186787:web:ac914827ebebda987f2916" };
        const app = initializeApp(firebaseConfig); const db = getFirestore(app);
        const perfil = JSON.parse(localStorage.getItem('perfilLoja'));

        // Chamar o Marcelo (Apenas quando clicar)
        window.chamarAgora = async () => {
            if(!perfil) return alert("Configure seu nome primeiro!");
            await addDoc(collection(db, "chamados"), { 
                loja: perfil.nome, status: "Pendente", tempo: "", timestamp: Date.now() 
            });
        };

        window.aceitarTempo = async (id, acao) => {
            if(acao === 'OK') await updateDoc(doc(db, "chamados", id), { status: "Confirmado" });
            else await deleteDoc(doc(db, "chamados", id));
        };

        window.onload = () => {
            if(!perfil) return document.getElementById('reg').classList.remove('hidden');
            document.getElementById('app').classList.remove('hidden');
            document.getElementById('exibirLoja').innerText = perfil.nome;

            onSnapshot(query(collection(db, "chamados"), where("loja", "==", perfil.nome)), (snaps) => {
                const painel = document.getElementById('statusChamado'); painel.innerHTML = "";
                snaps.forEach(d => {
                    const c = d.data();
                    if(c.status === "Respondido") {
                        painel.innerHTML = `<div class="bg-blue-600 text-white p-6 rounded-3xl shadow-xl text-center">
                            <p class="font-bold mb-4">Marcelo chega em ${c.tempo}?</p>
                            <div class="flex gap-2">
                                <button onclick="aceitarTempo('${d.id}', 'OK')" class="flex-1 bg-green-400 text-blue-900 font-black py-3 rounded-2xl">SIM</button>
                                <button onclick="aceitarTempo('${d.id}', 'NAO')" class="flex-1 bg-red-400 text-white font-black py-3 rounded-2xl">NÃƒO</button>
                            </div>
                        </div>`;
                    } else if(c.status === "Confirmado") {
                        painel.innerHTML = `<div class="bg-green-500 text-white p-6 rounded-3xl font-black text-center animate-pulse shadow-lg">MOTOBOY A CAMINHO! ðŸ›µ</div>`;
                    }
                });
            });
        };

        window.salvarPerfil = () => {
            localStorage.setItem('perfilLoja', JSON.stringify({ nome: document.getElementById('n').value }));
            location.reload();
        };
    </script>
</head>
<body class="bg-gray-100 p-4">
    <div id="reg" class="max-w-md mx-auto bg-white p-8 rounded-3xl hidden shadow-xl text-center">
        <input id="n" placeholder="Nome da sua Loja" class="w-full p-4 mb-4 bg-gray-50 rounded-2xl border">
        <button onclick="salvarPerfil()" class="w-full bg-blue-600 text-white font-bold py-4 rounded-2xl shadow-lg">COMEÃ‡AR</button>
    </div>
    <div id="app" class="max-w-md mx-auto hidden space-y-6">
        <div class="text-center"><h1 id="exibirLoja" class="font-black text-blue-900 italic uppercase text-2xl"></h1></div>
        <button onclick="chamarAgora()" class="w-full bg-blue-600 text-white font-black py-8 rounded-[40px] shadow-2xl text-2xl active:scale-95 transition-all">CHAMAR MARCELO ðŸ›µ</button>
        <div id="statusChamado"></div>
    </div>
</body>
</html>
